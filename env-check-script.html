<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ××©×ª× ×™ ×¡×‘×™×‘×” - Google Analytics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .section {
            background: rgba(255,255,255,0.1);
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
        }
        .code-block {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            margin: 15px 0;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196F3; }
        button {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 5px;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border-right: 4px solid #4ECDC4;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ×‘×“×™×§×ª ×”×’×“×¨×•×ª Google Analytics</h1>
        <p>×¡×§×¨×™×¤×˜ ×–×” ×‘×•×“×§ ×•××¡×‘×™×¨ ××™×š ×œ×”×’×“×™×¨ × ×›×•×Ÿ ××ª Google Analytics</p>

        <div class="section">
            <h3>ğŸ” ××¦×‘ × ×•×›×—×™</h3>
            <div id="current-status"></div>
            <button onclick="checkCurrentSettings()">×‘×“×•×§ ×”×’×“×¨×•×ª × ×•×›×—×™×•×ª</button>
        </div>

        <div class="section">
            <h3>ğŸ“‹ ×”×•×¨××•×ª ×”×ª×§× ×”</h3>
            
            <div class="step">
                <h4>×©×œ×‘ 1: ×™×¦×™×¨×ª Measurement ID ×‘-Google Analytics</h4>
                <p>1. ×›× ×¡ ×œ-<a href="https://analytics.google.com" target="_blank" style="color: #4ECDC4;">Google Analytics</a></p>
                <p>2. ×¦×•×¨ × ×›×¡ (Property) ×—×“×©</p>
                <p>3. ×‘×—×¨ "Web" ×›×¤×œ×˜×¤×•×¨××”</p>
                <p>4. ×”×–×Ÿ ××ª ×›×ª×•×‘×ª ×”××ª×¨: <code>https://gift-finder.vercel.app</code></p>
                <p>5. ×”×¢×ª×§ ××ª ×”-Measurement ID (××ª×—×™×œ ×‘-G-)</p>
            </div>

            <div class="step">
                <h4>×©×œ×‘ 2: ×”×’×“×¨×” ××§×•××™×ª (×œ×¤×™×ª×•×—)</h4>
                <p>×¦×•×¨ ×§×•×‘×¥ <code>.env.local</code> ×‘×ª×™×§×™×™×ª ×”×¤×¨×•×™×§×˜:</p>
                <div class="code-block">NEXT_PUBLIC_GA_MEASUREMENT_ID=G-YOUR-ID-HERE</div>
                <p>×”×—×œ×£ <code>G-YOUR-ID-HERE</code> ×‘-Measurement ID ×”×××™×ª×™ ×©×œ×š</p>
            </div>

            <div class="step">
                <h4>×©×œ×‘ 3: ×”×’×“×¨×” ×‘-Vercel (×œ×¤×¨×•×“×§×©×Ÿ)</h4>
                <p>1. ×›× ×¡ ×œ×¤×× ×œ ×”× ×™×”×•×œ ×©×œ Vercel</p>
                <p>2. ×‘×—×¨ ××ª ×”×¤×¨×•×™×§×˜ ×©×œ×š</p>
                <p>3. ×œ×—×¥ ×¢×œ Settings â†’ Environment Variables</p>
                <p>4. ×”×•×¡×£ ××©×ª× ×” ×—×“×©:</p>
                <div class="code-block">Name: NEXT_PUBLIC_GA_MEASUREMENT_ID
Value: G-YOUR-ID-HERE
Environment: Production, Preview, Development</div>
                <p>5. ×¤×¨×•×¡ ××—×“×© ××ª ×”××ª×¨</p>
            </div>

            <div class="step">
                <h4>×©×œ×‘ 4: ×‘×“×™×§×”</h4>
                <p>×œ××—×¨ ×”×”×’×“×¨×”, ×‘×“×•×§:</p>
                <ul>
                    <li>×”×¨×¥ ××ª ×”×¡×§×¨×™×¤×˜×™× ×œ×‘×“×™×§×” ×©×™×¦×¨×ª×™</li>
                    <li>×‘×“×•×§ ×‘-Google Analytics â†’ Realtime</li>
                    <li>×—×›×” 24-48 ×©×¢×•×ª ×œ× ×ª×•× ×™× ××œ××™×</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ§ª ×‘×“×™×§×•×ª ××ª×§×“××•×ª</h3>
            <button onclick="simulateGA()">×¡×™××•×œ×¦×™×™×ª Google Analytics</button>
            <button onclick="checkNetworkRequests()">×‘×“×™×§×ª ×‘×§×©×•×ª ×¨×©×ª</button>
            <button onclick="validateMeasurementID()">×××ª Measurement ID</button>
            <div id="advanced-results"></div>
        </div>

        <div class="section">
            <h3>ğŸ”§ ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª × ×¤×•×¦×•×ª</h3>
            <div id="troubleshooting"></div>
            <button onclick="runTroubleshooting()">××‘×—×Ÿ ×‘×¢×™×•×ª</button>
        </div>
    </div>

    <script>
        function addResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${new Date().toLocaleTimeString('he-IL')}] ${message}`;
            container.appendChild(div);
        }

        function checkCurrentSettings() {
            const container = document.getElementById('current-status');
            container.innerHTML = '';

            // Check if we're in Next.js environment
            const isNextJS = typeof window !== 'undefined' && window.location;
            addResult('current-status', `ğŸŒ ×¡×‘×™×‘×”: ${isNextJS ? '×“×¤×“×¤×Ÿ' : '×©×¨×ª'}`, 'info');
            addResult('current-status', `ğŸ“ URL × ×•×›×—×™: ${window.location.href}`, 'info');
            addResult('current-status', `ğŸ”’ ×¤×¨×•×˜×•×§×•×œ: ${window.location.protocol}`, window.location.protocol === 'https:' ? 'success' : 'warning');

            // Check for GA script
            const gaScript = document.querySelector('script[src*="googletagmanager.com/gtag/js"]');
            if (gaScript) {
                const url = gaScript.src;
                const idMatch = url.match(/id=([^&]+)/);
                const measurementId = idMatch ? idMatch[1] : '×œ× × ××¦×';
                addResult('current-status', `âœ… ×¡×§×¨×™×¤×˜ GA × ××¦× ×¢× ID: ${measurementId}`, 'success');
            } else {
                addResult('current-status', 'âŒ ×¡×§×¨×™×¤×˜ Google Analytics ×œ× × ××¦×', 'error');
            }

            // Check gtag function
            if (typeof window.gtag === 'function') {
                addResult('current-status', 'âœ… ×¤×•× ×§×¦×™×™×ª gtag ×–××™× ×”', 'success');
            } else {
                addResult('current-status', 'âŒ ×¤×•× ×§×¦×™×™×ª gtag ×œ× ×–××™× ×”', 'error');
            }

            // Check dataLayer
            if (window.dataLayer && Array.isArray(window.dataLayer)) {
                addResult('current-status', `âœ… dataLayer ×–××™×Ÿ ×¢× ${window.dataLayer.length} ××™×¨×•×¢×™×`, 'success');
            } else {
                addResult('current-status', 'âŒ dataLayer ×œ× ×–××™×Ÿ', 'error');
            }

            // Check cookies
            addResult('current-status', `ğŸª ×§×•×§×™×–: ${navigator.cookieEnabled ? '××•×¤×¢×œ×™×' : '×× ×•×˜×¨×œ×™×'}`, navigator.cookieEnabled ? 'success' : 'error');

            // Check for ad blockers (simple test)
            const testDiv = document.createElement('div');
            testDiv.className = 'adsbox';
            testDiv.style.display = 'none';
            document.body.appendChild(testDiv);
            setTimeout(() => {
                const blocked = testDiv.offsetHeight === 0;
                document.body.removeChild(testDiv);
                addResult('current-status', `ğŸš« ×—×•×¡× ×¤×¨×¡×•××•×ª: ${blocked ? '×–×•×”×” (×¢×œ×•×œ ×œ×—×¡×•× GA)' : '×œ× ×–×•×”×”'}`, blocked ? 'warning' : 'success');
            }, 100);
        }

        function simulateGA() {
            const container = document.getElementById('advanced-results');
            container.innerHTML = '';

            addResult('advanced-results', 'ğŸ§ª ××ª×—×™×œ ×¡×™××•×œ×¦×™×™×ª Google Analytics...', 'info');

            // Simulate GA initialization
            if (!window.dataLayer) {
                window.dataLayer = [];
                addResult('advanced-results', 'ğŸ“Š ×™×¦×™×¨×ª dataLayer', 'info');
            }

            if (!window.gtag) {
                window.gtag = function() {
                    dataLayer.push(arguments);
                    console.log('gtag called:', arguments);
                };
                addResult('advanced-results', 'ğŸ”§ ×™×¦×™×¨×ª ×¤×•× ×§×¦×™×™×ª gtag ××“×•××”', 'info');
            }

            // Send test events
            const testEvents = [
                { name: 'page_view', category: 'navigation' },
                { name: 'test_event', category: 'debug' },
                { name: 'user_engagement', category: 'engagement' }
            ];

            testEvents.forEach((event, index) => {
                setTimeout(() => {
                    window.gtag('event', event.name, {
                        event_category: event.category,
                        event_label: 'simulation',
                        value: index + 1
                    });
                    addResult('advanced-results', `ğŸ“¤ × ×©×œ×— ××™×¨×•×¢: ${event.name}`, 'success');
                }, (index + 1) * 500);
            });

            setTimeout(() => {
                addResult('advanced-results', `âœ… ×¡×™××•×œ×¦×™×” ×”×•×©×œ××”. dataLayer ××›×™×œ ${window.dataLayer.length} ××™×¨×•×¢×™×`, 'success');
            }, 2000);
        }

        function checkNetworkRequests() {
            const container = document.getElementById('advanced-results');
            container.innerHTML = '';

            addResult('advanced-results', 'ğŸŒ ×‘×•×“×§ ×‘×§×©×•×ª ×¨×©×ª ×œ-Google Analytics...', 'info');

            const testUrls = [
                'https://www.googletagmanager.com/gtag/js?id=G-B8TVNSFXJC',
                'https://www.google-analytics.com/analytics.js',
                'https://analytics.google.com'
            ];

            testUrls.forEach((url, index) => {
                const startTime = Date.now();
                
                fetch(url, { method: 'HEAD', mode: 'no-cors' })
                    .then(() => {
                        const loadTime = Date.now() - startTime;
                        addResult('advanced-results', `âœ… ${url} - ${loadTime}ms`, 'success');
                    })
                    .catch((error) => {
                        addResult('advanced-results', `âŒ ${url} - ×©×’×™××”: ${error.message}`, 'error');
                    });
            });
        }

        function validateMeasurementID() {
            const container = document.getElementById('advanced-results');
            container.innerHTML = '';

            const measurementId = 'G-B8TVNSFXJC'; // Current ID from code
            addResult('advanced-results', `ğŸ” ×‘×•×“×§ Measurement ID: ${measurementId}`, 'info');

            // Validate format
            const isValidFormat = /^G-[A-Z0-9]{10}$/.test(measurementId);
            addResult('advanced-results', `ğŸ“‹ ×¤×•×¨××˜: ${isValidFormat ? '×ª×§×™×Ÿ' : '×œ× ×ª×§×™×Ÿ'}`, isValidFormat ? 'success' : 'error');

            // Check if it's the default/example ID
            if (measurementId === 'G-B8TVNSFXJC') {
                addResult('advanced-results', 'âš ï¸ ×–×” × ×¨××” ×›××• ID ×‘×¨×™×¨×ª ××—×“×œ. ×•×•×“× ×©×–×” ×”-ID ×”× ×›×•×Ÿ ×-Google Analytics', 'warning');
            }

            // Try to load the specific script
            const scriptUrl = `https://www.googletagmanager.com/gtag/js?id=${measurementId}`;
            fetch(scriptUrl, { method: 'HEAD', mode: 'no-cors' })
                .then(() => {
                    addResult('advanced-results', 'âœ… ×¡×§×¨×™×¤×˜ GA ×¢× ID ×–×” × ×’×™×©', 'success');
                })
                .catch(() => {
                    addResult('advanced-results', 'âŒ ×‘×¢×™×” ×‘×’×™×©×” ×œ×¡×§×¨×™×¤×˜ GA ×¢× ID ×–×”', 'error');
                });
        }

        function runTroubleshooting() {
            const container = document.getElementById('troubleshooting');
            container.innerHTML = '';

            const issues = [];

            // Check protocol
            if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {
                issues.push({
                    problem: 'ğŸ”’ ×”××ª×¨ ×œ× ×¨×¥ ×¢×œ HTTPS',
                    solution: 'Google Analytics ×“×•×¨×© HTTPS. ×¤×¨×•×¡ ××ª ×”××ª×¨ ×œ-Vercel ××• ×©×¨×ª ××—×¨ ×¢× HTTPS'
                });
            }

            // Check cookies
            if (!navigator.cookieEnabled) {
                issues.push({
                    problem: 'ğŸª ×§×•×§×™×– ×× ×•×˜×¨×œ×™×',
                    solution: '××¤×©×¨ ×§×•×§×™×– ×‘×“×¤×“×¤×Ÿ. Google Analytics ×–×§×•×§ ×œ×§×•×›×™×– ×œ×¢×‘×•×“×” ×ª×§×™× ×”'
                });
            }

            // Check for ad blockers
            const testDiv = document.createElement('div');
            testDiv.className = 'adsbox';
            testDiv.style.display = 'none';
            document.body.appendChild(testDiv);
            setTimeout(() => {
                const blocked = testDiv.offsetHeight === 0;
                document.body.removeChild(testDiv);
                
                if (blocked) {
                    issues.push({
                        problem: 'ğŸš« ×—×•×¡× ×¤×¨×¡×•××•×ª ×–×•×”×”',
                        solution: '× ×˜×¨×œ ××ª ×—×•×¡× ×”×¤×¨×¡×•××•×ª ×œ××ª×¨ ×–×” ××• ×”×©×ª××© ×‘××¦×‘ ×¤×¨×˜×™'
                    });
                }

                // Check GA script
                if (!document.querySelector('script[src*="googletagmanager.com/gtag/js"]')) {
                    issues.push({
                        problem: 'ğŸ“œ ×¡×§×¨×™×¤×˜ Google Analytics ×œ× × ×˜×¢×Ÿ',
                        solution: '×•×•×“× ×©××©×ª× ×” ×”×¡×‘×™×‘×” NEXT_PUBLIC_GA_MEASUREMENT_ID ××•×’×“×¨ × ×›×•×Ÿ'
                    });
                }

                // Check gtag function
                if (typeof window.gtag !== 'function') {
                    issues.push({
                        problem: 'ğŸ”§ ×¤×•× ×§×¦×™×™×ª gtag ×œ× ×–××™× ×”',
                        solution: '×•×•×“× ×©×¡×§×¨×™×¤×˜ GA × ×˜×¢×Ÿ ×œ×¤× ×™ ×”×¤×¢×œ×ª gtag'
                    });
                }

                // Display results
                if (issues.length === 0) {
                    addResult('troubleshooting', 'âœ… ×œ× × ××¦××• ×‘×¢×™×•×ª ×™×“×•×¢×•×ª!', 'success');
                    addResult('troubleshooting', 'ğŸ’¡ ×× ×¢×“×™×™×Ÿ ×œ× ×¨×•××” × ×ª×•× ×™×, ×—×›×” 24-48 ×©×¢×•×ª', 'info');
                } else {
                    addResult('troubleshooting', `âŒ × ××¦××• ${issues.length} ×‘×¢×™×•×ª:`, 'error');
                    issues.forEach((issue, index) => {
                        addResult('troubleshooting', `<br><strong>×‘×¢×™×” ${index + 1}:</strong> ${issue.problem}`, 'error');
                        addResult('troubleshooting', `<strong>×¤×ª×¨×•×Ÿ:</strong> ${issue.solution}`, 'info');
                    });
                }
            }, 100);
        }

        // Auto-run basic check on load
        window.addEventListener('load', () => {
            setTimeout(checkCurrentSettings, 1000);
        });
    </script>
</body>
</html>