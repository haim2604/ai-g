<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª Google Analytics ×‘××ª×¨ ×”×—×™</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .test-box {
            background: rgba(255,255,255,0.1);
            margin: 15px 0;
            padding: 20px;
            border-radius: 10px;
            border-right: 4px solid #4ECDC4;
        }
        .test-box.error {
            border-right-color: #f44336;
        }
        .test-box.warning {
            border-right-color: #ff9800;
        }
        button {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 5px;
        }
        .result {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196F3; }
        .iframe-container {
            position: relative;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 8px;
        }
        .url-input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ×‘×“×™×§×ª Google Analytics ×‘××ª×¨ ×”×—×™</h1>
        <p>×›×œ×™ ×–×” ×‘×•×“×§ ××ª ×”××ª×¨ ×©×œ×š ×•××–×”×” ×‘×¢×™×•×ª ×‘-Google Analytics</p>

        <div class="test-box">
            <h3>ğŸŒ ×›×ª×•×‘×ª ×”××ª×¨ ×œ×‘×“×™×§×”</h3>
            <input type="url" id="site-url" class="url-input" value="https://gift-pt.com" placeholder="×”×–×Ÿ ×›×ª×•×‘×ª ××ª×¨">
            <button onclick="checkSite()">ğŸ” ×‘×“×•×§ ××ª×¨</button>
            <button onclick="loadSiteInFrame()">ğŸ“± ×˜×¢×Ÿ ×‘××ª×¨</button>
        </div>

        <div class="test-box" id="site-analysis">
            <h3>ğŸ“Š × ×™×ª×•×— ×”××ª×¨</h3>
            <div id="analysis-results"></div>
        </div>

        <div class="test-box" id="ga-detection">
            <h3>ğŸ” ×–×™×”×•×™ Google Analytics</h3>
            <div id="ga-results"></div>
        </div>

        <div class="test-box" id="network-test">
            <h3>ğŸŒ ×‘×“×™×§×ª ×¨×©×ª</h3>
            <div id="network-results"></div>
            <button onclick="testNetworkConnectivity()">×‘×“×•×§ ×—×™×‘×•×¨ ×¨×©×ª</button>
        </div>

        <div class="test-box" id="live-test">
            <h3>ğŸš€ ×‘×“×™×§×” ×—×™×”</h3>
            <div id="live-results"></div>
            <button onclick="runLiveTest()">×”×¨×¥ ×‘×“×™×§×” ×—×™×”</button>
        </div>

        <div class="iframe-container" id="site-frame-container" style="display: none;">
            <h3>ğŸ“± ×ª×¦×•×’×ª ×”××ª×¨</h3>
            <iframe id="site-frame"></iframe>
            <button onclick="analyzeFrameContent()">× ×ª×— ×ª×•×›×Ÿ</button>
        </div>
    </div>

    <script>
                    let siteUrl = 'https://gift-pt.com';

        function addResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString('he-IL')}] ${message}`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        async function checkSite() {
            siteUrl = document.getElementById('site-url').value;
            if (!siteUrl.startsWith('http')) {
                siteUrl = 'https://' + siteUrl;
            }

            clearResults('analysis-results');
            clearResults('ga-results');
            
            addResult('analysis-results', `ğŸ” ×‘×•×“×§ ××ª×¨: ${siteUrl}`, 'info');

            try {
                // Test basic connectivity
                const response = await fetch(siteUrl, { 
                    method: 'HEAD', 
                    mode: 'no-cors',
                    cache: 'no-cache'
                });
                
                addResult('analysis-results', 'âœ… ×”××ª×¨ × ×’×™×©', 'success');
                
                // Check if HTTPS
                if (siteUrl.startsWith('https://')) {
                    addResult('analysis-results', 'âœ… ×”××ª×¨ ×¨×¥ ×¢×œ HTTPS', 'success');
                } else {
                    addResult('analysis-results', 'âš ï¸ ×”××ª×¨ ×œ× ×¨×¥ ×¢×œ HTTPS - GA ×¢×œ×•×œ ×œ× ×œ×¢×‘×•×“', 'warning');
                }

                // Try to detect GA by checking common endpoints
                await detectGoogleAnalytics();

            } catch (error) {
                addResult('analysis-results', `âŒ ×©×’×™××” ×‘×’×™×©×” ×œ××ª×¨: ${error.message}`, 'error');
            }
        }

        async function detectGoogleAnalytics() {
            addResult('ga-results', 'ğŸ” ××—×¤×© Google Analytics...', 'info');

            // List of common GA endpoints and scripts
            const gaEndpoints = [
                '/gtag/js?id=G-',
                '/analytics.js',
                '/gtm.js'
            ];

            const gaHosts = [
                'www.googletagmanager.com',
                'www.google-analytics.com'
            ];

            // Check for GA script URLs
            for (const host of gaHosts) {
                for (const endpoint of gaEndpoints) {
                    try {
                        const testUrl = `https://${host}${endpoint}`;
                        const response = await fetch(testUrl, { 
                            method: 'HEAD', 
                            mode: 'no-cors' 
                        });
                        addResult('ga-results', `âœ… ${host}${endpoint} × ×’×™×©`, 'success');
                    } catch (error) {
                        addResult('ga-results', `âŒ ${host}${endpoint} ×œ× × ×’×™×©`, 'error');
                    }
                }
            }

            // Try to detect if GA is implemented by checking for common patterns
            addResult('ga-results', 'ğŸ” ×× ×¡×” ×œ×–×”×•×ª ×™×™×©×•× GA ×‘××ª×¨...', 'info');
            
            // This is limited due to CORS, but we can try some techniques
            try {
                // Check if we can access the site's HTML (limited by CORS)
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(siteUrl)}`;
                const response = await fetch(proxyUrl);
                const data = await response.json();
                
                if (data.contents) {
                    const html = data.contents;
                    
                    // Look for GA patterns
                    if (html.includes('googletagmanager.com/gtag/js')) {
                        addResult('ga-results', 'âœ… × ××¦× ×¡×§×¨×™×¤×˜ Google Analytics', 'success');
                        
                        // Try to extract measurement ID
                        const idMatch = html.match(/gtag\/js\?id=([^"&]+)/);
                        if (idMatch) {
                            addResult('ga-results', `ğŸ“Š Measurement ID: ${idMatch[1]}`, 'info');
                        }
                    } else {
                        addResult('ga-results', 'âŒ ×œ× × ××¦× ×¡×§×¨×™×¤×˜ Google Analytics', 'error');
                    }

                    if (html.includes('gtag(')) {
                        addResult('ga-results', 'âœ… × ××¦××• ×§×¨×™××•×ª gtag', 'success');
                    } else {
                        addResult('ga-results', 'âŒ ×œ× × ××¦××• ×§×¨×™××•×ª gtag', 'error');
                    }

                    if (html.includes('dataLayer')) {
                        addResult('ga-results', 'âœ… × ××¦× dataLayer', 'success');
                    } else {
                        addResult('ga-results', 'âŒ ×œ× × ××¦× dataLayer', 'error');
                    }

                } else {
                    addResult('ga-results', 'âš ï¸ ×œ× × ×™×ª×Ÿ ×œ×’×©×ª ×œ×ª×•×›×Ÿ ×”××ª×¨ ×‘×’×œ×œ ××’×‘×œ×•×ª CORS', 'warning');
                }

            } catch (error) {
                addResult('ga-results', `âš ï¸ ×œ× × ×™×ª×Ÿ ×œ× ×ª×— ××ª ×ª×•×›×Ÿ ×”××ª×¨: ${error.message}`, 'warning');
            }
        }

        async function testNetworkConnectivity() {
            clearResults('network-results');
            addResult('network-results', 'ğŸŒ ×‘×•×“×§ ×—×™×‘×•×¨ ×¨×©×ª ×œ-Google Analytics...', 'info');

            const testUrls = [
                'https://www.googletagmanager.com/gtag/js?id=G-B8TVNSFXJC',
                'https://www.google-analytics.com/analytics.js',
                'https://www.google-analytics.com/collect',
                'https://analytics.google.com',
                siteUrl
            ];

            for (const url of testUrls) {
                const startTime = Date.now();
                try {
                    await fetch(url, { 
                        method: 'HEAD', 
                        mode: 'no-cors',
                        cache: 'no-cache'
                    });
                    const loadTime = Date.now() - startTime;
                    addResult('network-results', `âœ… ${url} - ${loadTime}ms`, 'success');
                } catch (error) {
                    addResult('network-results', `âŒ ${url} - ${error.message}`, 'error');
                }
            }
        }

        function loadSiteInFrame() {
            const frameContainer = document.getElementById('site-frame-container');
            const frame = document.getElementById('site-frame');
            
            frame.src = siteUrl;
            frameContainer.style.display = 'block';
            
            // Try to analyze the frame after it loads
            frame.onload = () => {
                addResult('analysis-results', 'ğŸ“± ×”××ª×¨ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×” ×‘×¤×¨×™×™×', 'success');
                setTimeout(analyzeFrameContent, 2000);
            };

            frame.onerror = () => {
                addResult('analysis-results', 'âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”××ª×¨ ×‘×¤×¨×™×™×', 'error');
            };
        }

        function analyzeFrameContent() {
            const frame = document.getElementById('site-frame');
            
            try {
                // This will likely fail due to CORS, but let's try
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                
                if (frameDoc) {
                    addResult('analysis-results', 'ğŸ” ×× ×ª×— ×ª×•×›×Ÿ ×”×¤×¨×™×™×...', 'info');
                    
                    // Check for GA scripts
                    const gaScripts = frameDoc.querySelectorAll('script[src*="googletagmanager.com"]');
                    if (gaScripts.length > 0) {
                        addResult('analysis-results', `âœ… × ××¦××• ${gaScripts.length} ×¡×§×¨×™×¤×˜×™ GA`, 'success');
                        gaScripts.forEach((script, index) => {
                            addResult('analysis-results', `ğŸ“œ ×¡×§×¨×™×¤×˜ ${index + 1}: ${script.src}`, 'info');
                        });
                    } else {
                        addResult('analysis-results', 'âŒ ×œ× × ××¦××• ×¡×§×¨×™×¤×˜×™ GA', 'error');
                    }

                    // Check for gtag in global scope
                    if (frame.contentWindow.gtag) {
                        addResult('analysis-results', 'âœ… ×¤×•× ×§×¦×™×™×ª gtag ×–××™× ×”', 'success');
                    } else {
                        addResult('analysis-results', 'âŒ ×¤×•× ×§×¦×™×™×ª gtag ×œ× ×–××™× ×”', 'error');
                    }

                    // Check dataLayer
                    if (frame.contentWindow.dataLayer) {
                        addResult('analysis-results', `âœ… dataLayer ×–××™×Ÿ ×¢× ${frame.contentWindow.dataLayer.length} ××™×¨×•×¢×™×`, 'success');
                    } else {
                        addResult('analysis-results', 'âŒ dataLayer ×œ× ×–××™×Ÿ', 'error');
                    }

                } else {
                    addResult('analysis-results', 'âš ï¸ ×œ× × ×™×ª×Ÿ ×œ×’×©×ª ×œ×ª×•×›×Ÿ ×”×¤×¨×™×™× ×‘×’×œ×œ ××’×‘×œ×•×ª CORS', 'warning');
                }

            } catch (error) {
                addResult('analysis-results', `âš ï¸ ×œ× × ×™×ª×Ÿ ×œ× ×ª×— ××ª ×”×¤×¨×™×™×: ${error.message}`, 'warning');
                addResult('analysis-results', 'ğŸ’¡ ×–×” × ×•×¨××œ×™ ×‘×’×œ×œ ××’×‘×œ×•×ª ××‘×˜×—×” ×©×œ ×”×“×¤×“×¤×Ÿ', 'info');
            }
        }

        async function runLiveTest() {
            clearResults('live-results');
            addResult('live-results', 'ğŸš€ ××ª×—×™×œ ×‘×“×™×§×” ×—×™×”...', 'info');

            // Test 1: Check if we can send events to GA
            addResult('live-results', 'ğŸ“Š ×‘×•×“×§ ×× × ×™×ª×Ÿ ×œ×©×œ×•×— ××™×¨×•×¢×™× ×œ-GA...', 'info');
            
            try {
                // Try to send a test event to GA collect endpoint
                const collectUrl = 'https://www.google-analytics.com/collect';
                const params = new URLSearchParams({
                    v: '1',
                    tid: 'G-B8TVNSFXJC',
                    cid: '555',
                    t: 'event',
                    ec: 'test',
                    ea: 'live_test',
                    el: 'external_script'
                });

                const response = await fetch(collectUrl, {
                    method: 'POST',
                    body: params,
                    mode: 'no-cors'
                });

                addResult('live-results', 'âœ… ×‘×§×©×” ×œ-GA Collect × ×©×œ×—×”', 'success');
                
            } catch (error) {
                addResult('live-results', `âŒ ×©×’×™××” ×‘×©×œ×™×—×” ×œ-GA: ${error.message}`, 'error');
            }

            // Test 2: Check DNS resolution
            addResult('live-results', 'ğŸŒ ×‘×•×“×§ ×¨×–×•×œ×•×¦×™×™×ª DNS...', 'info');
            
            const dnsTargets = [
                'www.googletagmanager.com',
                'www.google-analytics.com',
                'analytics.google.com'
            ];

            for (const target of dnsTargets) {
                try {
                    const response = await fetch(`https://${target}`, { 
                        method: 'HEAD', 
                        mode: 'no-cors' 
                    });
                    addResult('live-results', `âœ… ${target} × ×’×™×©`, 'success');
                } catch (error) {
                    addResult('live-results', `âŒ ${target} ×œ× × ×’×™×©`, 'error');
                }
            }

            // Test 3: Performance check
            addResult('live-results', 'âš¡ ×‘×•×“×§ ×‘×™×¦×•×¢×™×...', 'info');
            
            const perfStart = performance.now();
            try {
                await fetch('https://www.googletagmanager.com/gtag/js?id=G-B8TVNSFXJC', { 
                    method: 'HEAD', 
                    mode: 'no-cors' 
                });
                const perfEnd = performance.now();
                const loadTime = Math.round(perfEnd - perfStart);
                
                if (loadTime < 1000) {
                    addResult('live-results', `âœ… ×–××Ÿ ×˜×¢×™× ×ª GA: ${loadTime}ms (××”×™×¨)`, 'success');
                } else if (loadTime < 3000) {
                    addResult('live-results', `âš ï¸ ×–××Ÿ ×˜×¢×™× ×ª GA: ${loadTime}ms (××™×˜×™)`, 'warning');
                } else {
                    addResult('live-results', `âŒ ×–××Ÿ ×˜×¢×™× ×ª GA: ${loadTime}ms (××™×˜×™ ×××•×“)`, 'error');
                }
            } catch (error) {
                addResult('live-results', `âŒ ×©×’×™××” ×‘×‘×“×™×§×ª ×‘×™×¦×•×¢×™×: ${error.message}`, 'error');
            }

            addResult('live-results', 'ğŸ‰ ×‘×“×™×§×” ×—×™×” ×”×•×©×œ××”!', 'success');
            addResult('live-results', 'ğŸ’¡ ×× ×”×›×œ × ×¨××” ×ª×§×™×Ÿ, ×‘×“×•×§ ×‘-Google Analytics Realtime', 'info');
        }

        // Auto-run basic checks on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkSite();
            }, 1000);
        });

        // Update URL when input changes
        document.getElementById('site-url').addEventListener('change', (e) => {
            siteUrl = e.target.value;
        });
    </script>
</body>
</html>